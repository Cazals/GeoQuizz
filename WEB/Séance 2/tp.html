<!doctype html>
<html>
<head>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<script>

var ListeMarker = [];
var carte; // servira a stocker l'objet GMap
// on la met globale car elle risque d'etre utilisée à différents endroits

function affichercarte() {
		
	//var latlng = new google.maps.LatLng(43.5483, 1.5029362); //Toulouse
	var latlng = new google.maps.LatLng(48.866667,2.333333); //Paris
	//objet contenant des propriétés avec des identificateurs prédéfinis dans Google Maps permettant
	//de définir des options d'affichage de notre carte
	var options = {
		center: latlng,
		zoom: 13,
		mapTypeId: google.maps.MapTypeId.SATELLITE
	};
	 
	//constructeur de la carte qui prend en paramêtre le conteneur HTML
	//dans lequel la carte doit s'afficher et les options
	carte = new google.maps.Map(document.getElementById("carte"), options);
	
	
	recupedata();
	
	window.setInterval("maj()",5000);

	
	
}

function recupedata(){
	console.log("ok");
	// appel web service type get
	$.ajax({
			url: "https://api.jcdecaux.com/vls/v1/stations?contract=Paris&apiKey=90866e021aaa6ed8790cd89b85864c9ab5dbfed3",
			type: "GET",
			dataType: "json", // optionnel : format que je souhaite en réponse. si pas le cas je partirai en erreur!
			success: callbackSucces, // fonction de callback
			error: function(data) {
				console.log("Erreur Ajax :" + data);
			},
	});


}

function callbackSucces(donnees) {
	console.log("ok");
	// je récupere le résultat de l'appel webservices
	
	var JSONTab = donnees;
	var obj;

	for(var i=0;i<JSONTab.length;i++){
		obj = JSONTab[i];
		//console.log(obj.number + '-' + obj.name);
		var marker;
		
		if (ListeMarker[i] == null){
			marker = new google.maps.Marker(
			 { 
				position: new google.maps.LatLng(obj.position.lat, obj.position.lng), 
				title:'Il reste ' + obj.available_bike_stands +' vélo'
				
			});
			ListeMarker[i] = marker;	
			marker.setMap(carte);
			
		} else {
			marker = ListeMarker[i];
			marker.title='Il reste ' + obj.available_bike_stands +' vélo'
		}
				
		if(obj.available_bike_stands == 0){
				marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png')
		} else if (obj.available_bike_stands < 6){
			marker.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png')
		} else if (obj.available_bike_stands < 10){
			marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png')
		} else if (obj.available_bike_stands < 15){
			marker.setIcon('http://maps.google.com/mapfiles/ms/icons/yellow-dot.png')
		} else {
			marker.setIcon('http://maps.google.com/mapfiles/ms/icons/purple-dot.png')
		}	

		/*if(obj.status == "CLOSED"){
				marker.setIcon('http://maps.google.com/mapfiles/ms/icons/yellow-dot.png')
			}*/
			
			
		
		
	}


	
}

function maj(){


	console.log("maj");
	recupedata();
	
	
}




</script>
</head>

<body>

<input type="button" onclick="affichercarte();"value="carte">

<div id="carte" style="height: 500px;width:500px"></div>


</body>
</html>